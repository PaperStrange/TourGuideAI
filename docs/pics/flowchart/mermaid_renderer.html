<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>TourGuideAI Mermaid Diagrams</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 30px;
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        h2 {
            color: #444;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
            margin-top: 40px;
        }
        pre {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            overflow: auto;
        }
        .btn {
            display: inline-block;
            background-color: #4CAF50;
            color: white;
            padding: 8px 16px;
            text-align: center;
            text-decoration: none;
            font-size: 14px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            margin: 10px 0;
        }
        .btn:hover {
            background-color: #45a049;
        }
        .btn-download {
            background-color: #2196F3;
        }
        .btn-download:hover {
            background-color: #0b7dda;
        }
        .btn-download-all {
            background-color: #673AB7;
        }
        .btn-download-all:hover {
            background-color: #5E35B1;
        }
        .instructions {
            background-color: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 10px 15px;
            margin: 20px 0;
        }
        .note {
            background-color: #f9f9f9;
            border-left: 4px solid #4CAF50;
            padding: 10px 15px;
            margin-top: 10px;
            font-size: 0.9em;
        }
        .mermaid {
            margin: 0 auto;
            overflow: auto;
        }
        .actions {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .navigation {
            display: flex;
            gap: 10px;
        }
        .download {
            display: flex;
            gap: 10px;
        }
    </style>
    <!-- Load Mermaid -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
    <h1>TourGuideAI Mermaid Diagrams</h1>
    
    <div class="instructions">
        <p><strong>How to save as SVG:</strong></p>
        <ol>
            <li>Click on the buttons below to switch between diagrams</li>
            <li>Use the download buttons to save diagrams directly as SVG files</li>
            <li>Files will be saved with names: <code>project_documentation_map.svg</code> and <code>project_workflow.svg</code></li>
            <li>Or take a screenshot of the rendered diagram (Windows: Win+Shift+S)</li>
        </ol>
        <div class="note">
            <p>Note: SVG files can be opened in browsers or converted to PNG using tools like:</p>
            <ul>
                <li>Adobe Illustrator, Inkscape, or GIMP</li>
                <li>Online converters like <a href="https://convertio.co/svg-png/" target="_blank">Convertio</a> or <a href="https://cloudconvert.com/svg-to-png" target="_blank">CloudConvert</a></li>
                <li>Command-line tools like ImageMagick</li>
            </ul>
        </div>
    </div>
    
    <div class="actions">
        <div class="navigation">
            <button class="btn" onclick="showDiagram('filesmap')">Show Documentation Map</button>
            <button class="btn" onclick="showDiagram('workflow')">Show Project Workflow</button>
        </div>
        <div class="download">
            <button class="btn btn-download" onclick="downloadCurrentDiagram()">Download Current Diagram</button>
            <button class="btn btn-download-all" onclick="downloadAllDiagrams()">Download All Diagrams</button>
        </div>
    </div>
    
    <div id="filesmap-container" class="container">
        <h2>Documentation File Map</h2>
        <div class="mermaid">
%%{init: {
  "theme": "default",
  "themeVariables": {
    "primaryColor": "#f0f0f0",
    "primaryTextColor": "#333",
    "primaryBorderColor": "#666",
    "lineColor": "#666",
    "secondaryColor": "#f9f9f9",
    "tertiaryColor": "#fff"
  },
  "flowchart": {
    "curve": "basis",
    "diagramPadding": 20
  }
}}%%

flowchart TB
    %% Main Style Definitions
    classDef root fill:#f9f9f9,stroke:#333,stroke-width:2px,color:#333,font-weight:bold
    classDef docFile fill:#dff0d8,stroke:#3c763d,stroke-width:1px,color:#3c763d
    classDef projectFile fill:#d9edf7,stroke:#31708f,stroke-width:1px,color:#31708f
    classDef referenceFile fill:#fcf8e3,stroke:#8a6d3b,stroke-width:1px,color:#8a6d3b
    classDef testingFile fill:#f2dede,stroke:#a94442,stroke-width:1px,color:#a94442
    classDef lifecycleFile fill:#e8f4ff,stroke:#337ab7,stroke-width:1px,color:#337ab7
    
    %% Main root node
    README[README.md]
    
    %% Group nodes hierarchically to minimize crossings
    subgraph RootDocs ["Root Documentation"]
        README
        ARCHITECTURE[ARCHITECTURE.md]
        API_OVERVIEW[API_OVERVIEW.md]
        API_MIGRATION[API_MIGRATION.md]
        CONTRIBUTING[CONTRIBUTING.md]
        SECURITY[SECURITY.md]
    end
    
    subgraph DocInv ["Documentation"]
        DOC_INVENTORY[Document Inventory<br>project.document-inventory.md]
    end
    
    subgraph ProcessArea ["Process Documentation"]
        subgraph ProcessDocs ["Process Monitors"]
            WORKFLOW_CHECKLISTS[Workflow Checklists<br>project.workflow-checklists.md]
            PHASE_SIGNOFF[Phase Signoff<br>project.phase-signoff.md]
        end
        
        subgraph VersionDocs ["Version Control"]
            VERSION_HISTORY[Version History<br>project.versions.md]
            VERSION_CONTROL_REF[Version Control Reference<br>version-control.md]
        end
    end
    
    subgraph CodeArea ["Code & Structure"]
        subgraph RefactorDocs ["Refactoring"]
            REFACTORS_HISTORY[Refactoring History<br>project.refactors.md]
            REFACTORS_PLAN[Refactoring Plan<br>project.refactors-plan.md]
        end
        
        subgraph ReviewDocs ["Code Review"]
            CODE_REVIEW_CHECKLIST[Code Review Checklist<br>code-review-checklist.md]
            CODE_REVIEW_GUIDE[What to look for in Code Review<br>whats-code-review-looking-for.md]
            DEPENDENCIES[Dependencies Tracking<br>dependencies-tracking.md]
        end
    end
    
    subgraph LearnDocs ["Knowledge"]
        LESSONS[Lessons Learned<br>project.lessons.md]
    end
    
    subgraph TestArea ["Testing"]
        TEST_PLAN[Stability Test Plan<br>project.stability-test-plan.md]
        TEST_RESULTS[Test Execution Results<br>project.test-execution-results.md]
        TEST_SCENARIOS[Test Scenarios<br>project.test-scenarios.md]
        TEST_USER_STORY[Test User Stories<br>project.test-user-story.md]
    end
    
    subgraph DeployDocs ["Deployment"]
        DEPLOYMENT_PIPELINE[Deployment Pipeline<br>project.deployment-pipeline.md]
        DEPLOYMENT_PLAN[Deployment Plan<br>project.deployment-pipeline-plan.md]
    end
    
    subgraph PerfDocs ["Performance"]
        PERFORMANCE_PLAN[Performance Plan<br>project.performance-optimization-plan.md]
        PERFORMANCE_IMPL[Performance Implementation<br>project.performance-implementation-plan.md]
    end
    
    subgraph FeatureArea ["Feature Documentation"]
        FEATURES_README[src/features/README.md]
        MAP_VIZ_README[src/features/map-visualization/README.md]
        TESTS_README[src/tests/README.md]
    end
    
    %% Connect README to primary sections (cleaner layout)
    README --> RootDocs
    README --> DocInv
    README --> ProcessArea
    README --> CodeArea
    README --> LearnDocs
    README --> TestArea
    README --> DeployDocs
    README --> PerfDocs
    
    %% Core document relationships (careful placement to reduce crossings)
    DOC_INVENTORY --> ProcessDocs
    DOC_INVENTORY --> VersionDocs
    DOC_INVENTORY --> RefactorDocs
    DOC_INVENTORY --> ReviewDocs
    DOC_INVENTORY --> LearnDocs
    DOC_INVENTORY --> TestArea
    DOC_INVENTORY --> DeployDocs
    DOC_INVENTORY --> PerfDocs
    
    %% Workflow connections (minimized)
    WORKFLOW_CHECKLISTS --> LESSONS
    WORKFLOW_CHECKLISTS --> TEST_RESULTS
    WORKFLOW_CHECKLISTS --> REFACTORS_PLAN
    WORKFLOW_CHECKLISTS --> VERSION_HISTORY
    PHASE_SIGNOFF --> TEST_RESULTS
    
    %% Refactor connections (reduced)
    REFACTORS_HISTORY --> CODE_REVIEW_CHECKLIST
    
    %% Feature connections (simplified)
    FeatureArea --> TestArea
    FeatureArea --> RefactorDocs
    FeatureArea --> PerfDocs
    
    %% Apply classes to nodes
    class README,ARCHITECTURE,API_OVERVIEW,API_MIGRATION,CONTRIBUTING,SECURITY root
    class DOC_INVENTORY docFile
    class WORKFLOW_CHECKLISTS,PHASE_SIGNOFF projectFile
    class VERSION_HISTORY,VERSION_CONTROL_REF projectFile
    class REFACTORS_HISTORY,REFACTORS_PLAN projectFile
    class CODE_REVIEW_CHECKLIST,CODE_REVIEW_GUIDE,DEPENDENCIES projectFile
    class LESSONS projectFile
    class TEST_PLAN,TEST_RESULTS,TEST_SCENARIOS,TEST_USER_STORY testingFile
    class DEPLOYMENT_PIPELINE,DEPLOYMENT_PLAN projectFile
    class PERFORMANCE_PLAN,PERFORMANCE_IMPL projectFile
    class FEATURES_README,MAP_VIZ_README,TESTS_README referenceFile
    
    %% Style links by type
    linkStyle default stroke:#999,stroke-width:1px
        </div>
    </div>
    
    <div id="workflow-container" class="container" style="display: none;">
        <h2>Project Workflow</h2>
        <div class="mermaid">
%%{
  init: {
    'theme': 'base',
    'themeVariables': {
      'primaryColor': '#5D8AA8',
      'primaryTextColor': '#fff',
      'primaryBorderColor': '#5D8AA8',
      'lineColor': '#333333',
      'secondaryColor': '#006400',
      'tertiaryColor': '#fff',
      'lineWidth': '3px',
      'nodeBorder': '2px',
      'arrowheadSize': '1'
    },
    'flowchart': {
      'curve': 'basis',
      'useMaxWidth': false
    }
  }
}%%

flowchart TD
    %% Class definitions with distinct colors for each phase
    classDef initPhase fill:#5D8AA8,stroke:#333,stroke-width:2px,color:white,font-weight:bold
    classDef devPhase fill:#4CAF50,stroke:#333,stroke-width:2px,color:white,font-weight:bold
    classDef verifyPhase fill:#9C27B0,stroke:#333,stroke-width:2px,color:white,font-weight:bold
    classDef docsPhase fill:#FF9800,stroke:#333,stroke-width:2px,color:white,font-weight:bold
    classDef artifactsPhase fill:#FF5252,stroke:#333,stroke-width:2px,color:white,font-weight:bold
    classDef knowledgePhase fill:#009688,stroke:#333,stroke-width:2px,color:white,font-weight:bold
    classDef reviewPhase fill:#FFD700,stroke:#333,stroke-width:2px,color:black,font-weight:bold
    
    classDef action fill:#f9f9f9,stroke:#555,stroke-width:1.5px,color:black
    classDef milestone fill:#90EE90,stroke:#006400,stroke-width:2px,color:black,font-weight:bold
    classDef update fill:#E0F7FA,stroke:#00838F,stroke-width:1.5px,color:black,font-style:italic
    
    linkStyle default stroke:#333,stroke-width:3px
    
    Start([START NEW PHASE]):::milestone --> Init
    
    subgraph Init["1️⃣ INITIALIZATION"]
        I1[Create workflow checklist]
        I2[Review standards & documents]
        I3[Set up OKR framework]
        I4[Update project trackers]
        I5[Create planning documentation]
    end
    
    subgraph Dev["2️⃣ DEVELOPMENT"]
        D1[Execute tasks by priority]
        D2[Complete features sequentially] 
        D3[Track progress regularly]
        D4[Create test scenarios]
        UpdateCycle["Regular Updates:<br/>- Milestones<br/>- Project<br/>- Todos"]:::update
    end
    
    subgraph Verify["3️⃣ VERIFICATION"]
        V1[Verify milestones completion]
        V2[Verify tasks completion]
        V3[Run & verify all tests]
        V4[Check acceptance criteria]
    end
    
    subgraph Docs["4️⃣ DOCUMENTATION"]
        C1[Review code]
        RefactorLoop["Refactoring<br/>Cycle"]:::update
        C2[Document structural changes]
        C3[Update all documentation]
        C4[Verify workflow compliance]
    end
    
    subgraph Artifacts["5️⃣ ARTIFACTS"]
        A1[Update architecture documents]
        A2[Update API documentation]
        A3[Ensure consistent references]
        A4[Verify file paths & imports]
    end
    
    subgraph Knowledge["6️⃣ KNOWLEDGE"]
        K1[Record lessons learned]
        K2[Categorize knowledge by type]
        K3[Link to project workflow]
        K4[Prioritize reusable insights]
    end
    
    subgraph Final["7️⃣ FINAL REVIEW"]
        R1[Complete formal sign-off]
        R2[Verify all workflow steps]
        R3[Announce phase completion]
    end

    %% Primary workflow path with enhanced line styles
    Init --> Dev
    Dev --> Verify
    Verify --> Docs
    Docs --> Artifacts
    Artifacts --> Knowledge
    Knowledge --> Final
    Final --> NextPhase([START NEXT PHASE]):::milestone
    
    %% Update cycles and feedback loops with curved, distinctive lines
    Dev ==> UpdateCycle
    UpdateCycle -.-> Dev
    C1 ==> RefactorLoop
    RefactorLoop -.-> C1
    
    %% Lessons feedback loop with distinctive style
    Final -...-> Feedback[Apply lessons to next phase]
    Feedback -...-> Start
    
    %% Legend
    subgraph Legend["LEGEND"]
        L1[Phase Header]:::initPhase
        L2[Task/Action]:::action
        L3[Milestone]:::milestone
        L4[Update Cycle]:::update
        L5[Direct Flow] --> L3
        L6[Feedback Loop] -.-> L4
    end
    
    %% Apply classes to phases
    class Init initPhase
    class Dev devPhase
    class Verify verifyPhase
    class Docs docsPhase
    class Artifacts artifactsPhase
    class Knowledge knowledgePhase
    class Final reviewPhase
    
    %% Apply classes to nodes
    class I1,I2,I3,I4,I5,D1,D2,D3,D4,V1,V2,V3,V4,C1,C2,C3,C4,A1,A2,A3,A4,K1,K2,K3,K4,R1,R2,R3 action
    class Feedback,NextPhase,Start milestone
        </div>
    </div>
    
    <script>
        // Configure mermaid with optimal settings
        mermaid.initialize({
            startOnLoad: true,
            securityLevel: 'loose',
            theme: 'default',
            logLevel: 'debug', // Increased logging for troubleshooting
            fontFamily: 'Arial, sans-serif',
            fontSize: 14,
            flowchart: {
                htmlLabels: true,
                curve: 'linear', // Simpler curve type
                diagramPadding: 8,
                useMaxWidth: true
            }
        });

        // Current diagram tracker
        let currentDiagram = 'filesmap';
        
        // Flag to track if diagrams are rendered
        let diagramsRendered = {
            filesmap: false,
            workflow: false
        };

        // Function to toggle between diagrams
        function showDiagram(id) {
            console.log('Showing diagram:', id);
            
            // Hide all containers
            document.getElementById('filesmap-container').style.display = 'none';
            document.getElementById('workflow-container').style.display = 'none';
            
            // Show the selected container
            document.getElementById(`${id}-container`).style.display = 'block';
            
            // Update current diagram
            currentDiagram = id;
            
            // If diagram not yet rendered, re-initialize mermaid
            if (!diagramsRendered[id]) {
                console.log('Initializing diagram:', id);
                try {
                    mermaid.init(undefined, document.querySelectorAll(`#${id}-container .mermaid`));
                    diagramsRendered[id] = true;
                } catch (error) {
                    console.error('Error initializing diagram:', error);
                }
            }
        }
        
        // Function to download the current diagram
        function downloadCurrentDiagram() {
            // Make sure diagram is showing
            showDiagram(currentDiagram);
            
            // Give time for rendering to complete
            setTimeout(() => {
                const filename = currentDiagram === 'filesmap' ? 
                    'project_documentation_map.svg' : 'project_workflow.svg';
                
                const container = document.getElementById(`${currentDiagram}-container`);
                const svg = container.querySelector('svg');
                
                if (!svg) {
                    alert('Diagram not rendered yet. Please wait and try again.');
                    return;
                }
                
                // Helper function to fix SVG for export
                function prepareSvgForExport(originalSvg) {
                    // Get outer dimensions (including the container)
                    const containerRect = originalSvg.getBoundingClientRect();
                    
                    // Create a new SVG element
                    const newSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                    
                    // Set width and height to visible dimensions
                    newSvg.setAttribute('width', containerRect.width);
                    newSvg.setAttribute('height', containerRect.height);
                    newSvg.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
                    newSvg.setAttribute('xmlns:xlink', 'http://www.w3.org/1999/xlink');
                    newSvg.setAttribute('version', '1.1');
                    
                    // Add white background
                    const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                    rect.setAttribute('width', '100%');
                    rect.setAttribute('height', '100%');
                    rect.setAttribute('fill', 'white');
                    newSvg.appendChild(rect);
                    
                    // Add content of the original SVG
                    const svgContent = originalSvg.innerHTML;
                    newSvg.innerHTML += svgContent;
                    
                    return newSvg;
                }
                
                try {
                    // Prepare SVG for export
                    const exportSvg = prepareSvgForExport(svg);
                    
                    // Serialize to SVG string
                    const svgData = new XMLSerializer().serializeToString(exportSvg);
                    
                    // Create blob and URL
                    const svgBlob = new Blob([svgData], {type: 'image/svg+xml'});
                    const url = URL.createObjectURL(svgBlob);
                    
                    // Create download link
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                } catch (error) {
                    console.error('Error preparing SVG:', error);
                    alert('Error exporting SVG: ' + error.message);
                }
            }, 500); // Give time for rendering to complete
        }
        
        // Function to download all diagrams
        function downloadAllDiagrams() {
            // Save current view
            const currentView = currentDiagram;
            
            // Function to prepare SVG for export
            function prepareSvgForExport(originalSvg) {
                // Get outer dimensions
                const containerRect = originalSvg.getBoundingClientRect();
                
                // Create a new SVG element
                const newSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                
                // Set width and height to visible dimensions
                newSvg.setAttribute('width', containerRect.width);
                newSvg.setAttribute('height', containerRect.height);
                newSvg.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
                newSvg.setAttribute('xmlns:xlink', 'http://www.w3.org/1999/xlink');
                newSvg.setAttribute('version', '1.1');
                
                // Add white background
                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rect.setAttribute('width', '100%');
                rect.setAttribute('height', '100%');
                rect.setAttribute('fill', 'white');
                newSvg.appendChild(rect);
                
                // Add content of the original SVG
                const svgContent = originalSvg.innerHTML;
                newSvg.innerHTML += svgContent;
                
                return newSvg;
            }
            
            // Download filesmap
            showDiagram('filesmap');
            setTimeout(() => {
                const filesmapSvg = document.querySelector('#filesmap-container svg');
                if (filesmapSvg) {
                    try {
                        // Prepare SVG for export
                        const exportSvg = prepareSvgForExport(filesmapSvg);
                        
                        // Serialize to SVG string
                        const svgData = new XMLSerializer().serializeToString(exportSvg);
                        
                        // Create blob and URL
                        const svgBlob = new Blob([svgData], {type: 'image/svg+xml'});
                        const url = URL.createObjectURL(svgBlob);
                        
                        // Create download link
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'project_documentation_map.svg';
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                    } catch (error) {
                        console.error('Error preparing filesmap SVG:', error);
                    }
                }
                
                // Download workflow
                showDiagram('workflow');
                setTimeout(() => {
                    const workflowSvg = document.querySelector('#workflow-container svg');
                    if (workflowSvg) {
                        try {
                            // Prepare SVG for export
                            const exportSvg = prepareSvgForExport(workflowSvg);
                            
                            // Serialize to SVG string
                            const svgData = new XMLSerializer().serializeToString(exportSvg);
                            
                            // Create blob and URL
                            const svgBlob = new Blob([svgData], {type: 'image/svg+xml'});
                            const url = URL.createObjectURL(svgBlob);
                            
                            // Create download link
                            const a = document.createElement('a');
                            a.href = url;
                            a.download = 'project_workflow.svg';
                            document.body.appendChild(a);
                            a.click();
                            document.body.removeChild(a);
                            URL.revokeObjectURL(url);
                        } catch (error) {
                            console.error('Error preparing workflow SVG:', error);
                        }
                    }
                    
                    // Restore original view
                    showDiagram(currentView);
                }, 1000); // Extra time for workflow diagram to render
            }, 1000); // Extra time for filesmap diagram to render
        }

        // Initialize on page load
        window.addEventListener('load', function() {
            console.log('Page fully loaded, initializing diagrams');
            
            try {
                // Manually initialize mermaid to ensure diagrams are rendered
                mermaid.init(undefined, document.querySelectorAll('.mermaid'));
                console.log('Mermaid initialized');
                
                // Mark all diagrams as rendered
                diagramsRendered.filesmap = true;
                diagramsRendered.workflow = true;
            } catch (error) {
                console.error('Error initializing Mermaid:', error);
                alert('Error rendering diagrams: ' + error.message);
            }
            
            // Show the filesmap by default
            showDiagram('filesmap');
        });
    </script>
</body>
</html> 